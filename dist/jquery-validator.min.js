/**
* @fileOverview jquery-validator
* @description depend on jQuery
* @name jquery-validator.js
* @author thujikun
* @version 1.0.0
* Copyright (c) 2015 "thujikun" Ryosuke Tsuji
* Licensed under the MIT license.
*/(function(a){"use strict";function b(a,b,c){if("defineProperty"in Object)try{Object.defineProperty(a,b,{enumerable:!1,writable:!1,configurable:!1,value:c})}catch(d){a[b]=c}else a[b]=c}function c(a,b){return a.find(b.selector?b.selector:"[name="+b.name+"]")}var d=function(a,b){this._constructor(a,b)};!function(){b(d.prototype,"_defaults",{checks:{required:{listener:"_chkRequired",eventtype:["blur","input"]},"required-check":{listener:"_chkRequiredCheck",eventtype:[]},length:{listener:"_chkLength",eventtype:["blur"]},maxlength:{listener:"_chkMaxlength",eventtype:["blur","input"]},minlength:{listener:"_chkMinlength",eventtype:["blur"]},maxnum:{listener:"_chkMaxnum",eventtype:["blur","input"]},minnum:{listener:"_chkMinnum",eventtype:["blur","input"]},format:{listener:"_chkFormat",eventtype:{"default":["blur","input"],email:["blur"],date:["blur"]}},regexp:{listener:"_chkRegexp",eventtype:["blur","input"]},copy:{listener:"_chkCopy",eventtype:["input"]},same:{body:{listener:"_chkSame",eventtype:["focus","blur"]},confirmation:{listener:"_chkSame",eventtype:["focus","input","blur"]}},"date-around":{before:{listener:"_chkDateAround",eventtype:["blur"]},after:{listener:"_chkDateAround",eventtype:["blur"]}},credit:{"default":{listener:"_chkCredit",eventtype:["blur"]}}},format:{number:{regexp:"number"},"half-char":{regexp:"half-char"},half:{regexp:"half"},"half-kana":{regexp:"half-kana"},url:{regexp:"url"},tel:{regexp:"tel"},"tel-i18n":{regexp:"tel-i18n"},email:{regexp:"email"},"full-kana":{regexp:"full-kana"},"full-char":{regexp:"full-char"},date:{regexp:"date",special:"valid-date"},dateYM:{regexp:"dateYM",special:"valid-date"},credit:{regexp:"credit",special:"rune"}},regexp:{number:/^[0-9]*$/,"half-char":/^[0-9A-Za-z]*$/,half:/^[\x20-\x7e]*$/,"half-kana":/^[ｦ-ﾝ]*$/,tel:/^[0-9]*$/,"tel-i18n":/^[\+]?[0-9]*$/,url:/^(http|https):\/\/[^\.]+\.[^\.]/,email:/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/,"full-kana":/^[ァ-ヶ]*$/,"full-char":/^[^\x20-\x7eｱ-ﾝﾞﾟｧ-ｫｬ-ｮｰ]*$/,date:/^[0-9]{4}\/[0-9]{1,2}\/[0-9]{1,2}$/,dateYM:/^[0-9]{4}\/[0-9]{1,2}$/,credit:/^[0-9\-]*$/},MESSAGES:{REQUIRED:"{0}を入力してください。","REQUIRED-CHECK":"{0}を{1}つ以上選択してください。",MAXLENGTH:"{0}は{1}文字以下で入力してください。",LENGTH:"{0}は{1}文字で入力してください。",MINLENGTH:"{0}は{1}文字以上で入力してください。",MAXNUM:"{0}は{1}以内の数値を入力してください。",MINNUM:"{0}は{1}以上の数値を入力してください。",REGEXP:"不正な文字が含まれています。",COPY:"異なった{0}が入力されています。","FORMAT-NUMBER":"{0}は半角数字を入力してください。","FORMAT-HALF-CHAR":"{0}は半角英数字で入力してください。","FORMAT-HALF":"{0}は半角で入力してください。","FORMAT-HALF-KANA":"{0}は半角カナで入力してください。","FORMAT-TEL":"{0}は有効な電話番号を入力してください。","FORMAT-TEL-I18N":"{0}は有効な電話番号を入力してください。","FORMAT-URL":"{0}は有効なURLを入力してください。","FORMAT-EMAIL":"{0}は有効なメールアドレスを入力してください。","FORMAT-FULL-KANA":"{0}は全角カナで入力してください。","FORMAT-FULL-CHAR":"{0}は全角で入力してください。","FORMAT-DATE":"{0}には正しい日付書式で入力してください。","FORMAT-DATEYM":"{0}には正しい日付書式で入力してください。","FORMAT-RUNE":"不正なクレジットカード番号が入力されています。",SAME:"異なった{0}が入力されています。","DATE-AROUND":"{0}には{1}より前の日付を入力してください。",CREDIT:"不正なクレジットカード番号が入力されています。"}}),b(d.prototype,"CONST",{DEFAULT_ROLE:"default",NAME_SPACE:"validator",NAME_SPACE_UNIT:"unit",NAME_SPACE_RELATION:"relation",CHECKTYPE_UNIT:"unit",CHECKTYPE_RELATION:"relation"}),b(d.prototype,"_constructor",function(b,c){var d=this;this.config=a.extend(!0,{},this._defaults,b),this.options=c||[],this.relationElements={},b.checks&&a.each(b.checks,function(a,b){d.config.checks[a].eventtype=b.eventtype}),this.enable()}),b(d.prototype,"enable",function(){var a=this;return a.options.forEach(function(b){a._register(b)}),a._registerRelation(),a}),b(d.prototype,"disable",function(){var a=this.CONST,b="."+a.NAME_SPACE+"."+a.NAME_SPACE_UNIT,d=this.config.$form,e=this.options;return e.forEach(function(a){var e=c(d,a);e.off(b)}),this}),b(d.prototype,"add",function(a){return this.options.push(a),this._register(a),this._registerRelation(),this}),b(d.prototype,"formValidate",function(b){var d=a.Deferred(),e=[],f=[],g=this,h=g.config.checks,i=g.config.$form,j=g.options,k=g.relationElements,l=[];return j.forEach(function(d){var f=c(i,d),j=[],k=a.Deferred();f.size()&&(d.unit&&a.each(d.unit,function(a,b){j.push(g[h[a].listener]({type:"formvalidate"},f,b))}),e.push(k.promise()),a.when.apply(a,j).then(function(){var a=Array.prototype.slice.call(arguments);l.push(g._validateEnd({type:"formvalidate"},f,a,b)),k.resolve()}))}),a.each(k,function(c,d){var e=h[c];a.each(d,function(c,d){a.each(d,function(c,h){var i=e[c];h.forEach(function(c){var e=[],h=a.Deferred();e.push(g[i.listener]({type:"formvalidate"},c,d)),f.push(h.promise()),a.when.apply(a,e).then(function(){var a=Array.prototype.slice.call(arguments);l.push(g._validateEnd({type:"formvalidate"},c,a,b)),h.resolve()})})})})}),a.when.apply(a,e.concat(f)).then(function(){a.when.apply(a,l).then(function(){var a=Array.prototype.slice.call(arguments);d.resolveWith(i,[g._formValidateEnd(a)])})}),d.promise()}),b(d.prototype,"_formValidateEnd",function(a){var b={error:!1,data:[]};return a.forEach(function(c){return c.error?(b.error=!0,b.data=a,!1):void 0}),b}),b(d.prototype,"_register",function(b){var d=this,e=d.CONST,f="."+e.NAME_SPACE+"."+e.NAME_SPACE_UNIT,g=d.config.$form,h=c(g,b),i=d._createListenerSettings(b);h.size()&&(a.each(i,function(a,b){var c=!1,e=!1;h.on(a+f,function(a){var f=h.data("validation");c||requestAnimationFrame(function(){return e?void(e=!1):(b.forEach(function(a){a.args=f.unit[a.key]}),void requestAnimationFrame(function(){d._validate(a,h,b)}))})}),"input"===a&&(h.on("focus"+f,function(a){c=!0,requestAnimationFrame(function(){c=!1})}),h.on("blur"+f,function(a){e=!0,requestAnimationFrame(function(){e=!1})}))}),d._createRelationSettings(h,b.relation))}),b(d.prototype,"_registerRelation",function(){var b=this,c=b.CONST,d="."+c.NAME_SPACE+"."+c.NAME_SPACE_RELATION,e=b.config.checks,f=b.relationElements;a.each(f,function(c,f){var g=e[c];a.each(f,function(c,e){a.each(e,function(c,f){var h=g[c];f.forEach(function(c){var f={};c.off(d),h.eventtype.forEach(function(a){f[a]=f[a]||[],f[a].push({args:e,listener:h.listener})}),a.each(f,function(a,e){c.on(a+d,function(a){requestAnimationFrame(function(){b._validate(a,c,e)})})})})})})})}),b(d.prototype,"_createListenerSettings",function(b){var c,d=this.config.checks,e={};return b.unit&&a.each(b.unit,function(a){c="format"===a?d[a].eventtype[b.unit[a]]||d[a].eventtype["default"]:d[a].eventtype,c.forEach(function(b){e[b]=e[b]||[],e[b].push({key:a,listener:d[a].listener})})}),e}),b(d.prototype,"_createRelationSettings",function(b,c){var d=this.CONST,e=this.relationElements||{};return c&&(a.isArray(c)||(c=[c]),c.forEach(function(a){var c=a.role||d.DEFAULT_ROLE;e[a.type]=e[a.type]||{},e[a.type][a.key]=e[a.type][a.key]||{},e[a.type][a.key][c]=e[a.type][a.key][c]||[],e[a.type][a.key][c].push(b)})),e}),b(d.prototype,"_validate",function(b,c,d){var e=this,f=[];d.forEach(function(a){f.push(e[a.listener](b,c,a.args))}),a.when.apply(a,f).then(function(){var a=Array.prototype.slice.call(arguments);e._validateEnd(b,c,a)})}),b(d.prototype,"_validateEnd",function(b,c,d,e){var f,g=this,h=c.prop("title")||c.data("title")||"",i={error:!1,errorMessage:"",targetType:"body",eventtype:b.type,target:c},j={checkType:g.CONST.CHECKTYPE_RELATION,error:!1,errorMessage:"",eventtype:b.type,targetType:"relation"};return d.forEach(function(b){var c;i.error||(b.error?(i=a.extend(!0,{},i,b),b.errorMessage||(c=b.type.toUpperCase(),"format"===b.type&&(c=c+"-"+b.format.toUpperCase()),i.errorMessage=g._getMessage(c,h,b.condition)),b.checkType===g.CONST.CHECKTYPE_RELATION&&(j=a.extend(!0,{},i,b),b.errorMessage||(j.errorMessage=g._getMessage(c,h)))):(i.type=b.type,i.checkType=b.checkType,i.noTrigger=b.noTrigger)),b.checkType===g.CONST.CHECKTYPE_RELATION&&(f=j.relations=i.relations=b.relations)}),i.noTrigger||e||(c.trigger("validate",i).data("validator-result-"+i.checkType,i),f&&a.each(f,function(a,b){b.forEach(function(a){c!==a&&a.trigger("validate",j).data("validator-result-"+g.CONST.CHECKTYPE_RELATION,i)})})),i}),b(d.prototype,"_getMessage",function(a){var b=Array.prototype.slice.call(arguments),c=this.config.MESSAGES[a]||"";return b.shift(),b.forEach(function(a,b){c=c.replace("{"+b+"}",a,"g")}),c}),b(d.prototype,"_chkRequired",function(b,c,d){var e=a.Deferred(),f=c.val(),g={checkType:this.CONST.CHECKTYPE_UNIT,error:!1,type:"required",target:c,condition:!0};return d&&!f&&(g.error=!0),e.resolve(g),e.promise()}),b(d.prototype,"_chkRequiredCheck",function(b,c,d){var e=a.Deferred(),f=0,g={checkType:this.CONST.CHECKTYPE_UNIT,error:!1,type:"required-check",target:c,condition:d};return d===!0?d=1:d===!1&&(d=0),g.condition=d,c.each(function(){a(this).prop("checked")&&f++}),d>f&&(g.error=!0),e.resolve(g),e.promise()}),b(d.prototype,"_chkLength",function(b,c,d){var e=a.Deferred(),f=c.val(),g={checkType:this.CONST.CHECKTYPE_UNIT,error:!1,type:"length",target:c,condition:d};return d!==f.length&&(g.error=!0),e.resolve(g),e.promise()}),b(d.prototype,"_chkMaxlength",function(b,c,d){var e=a.Deferred(),f=c.val(),g={checkType:this.CONST.CHECKTYPE_UNIT,error:!1,type:"maxlength",target:c,condition:d};return d<f.length&&(g.error=!0),e.resolve(g),e.promise()}),b(d.prototype,"_chkMinlength",function(b,c,d){var e=a.Deferred(),f=c.val(),g={checkType:this.CONST.CHECKTYPE_UNIT,error:!1,type:"minlength",target:c,condition:d};return f.length<d&&(g.error=!0),e.resolve(g),e.promise()}),b(d.prototype,"_chkMaxnum",function(b,c,d){var e=a.Deferred(),f=c.val(),g={checkType:this.CONST.CHECKTYPE_UNIT,error:!1,type:"maxnum",target:c,condition:d};return d<parseInt(f,10)&&(g.error=!0),e.resolve(g),e.promise()}),b(d.prototype,"_chkMinnum",function(b,c,d){var e=a.Deferred(),f=c.val(),g={checkType:this.CONST.CHECKTYPE_UNIT,error:!1,type:"minnum",target:c,condition:d};return parseInt(f,10)<d&&(g.error=!0),e.resolve(g),e.promise()}),b(d.prototype,"_chkFormat",function(b,c,d){var e=this,f=a.Deferred(),g=this.config.format[d],h=[],i={checkType:e.CONST.CHECKTYPE_UNIT,error:!1,type:"format",format:d,target:c,condition:d};return a.each(g,function(a,d){switch(a){case"regexp":h.push(e._chkRegexp(b,c,e.config.regexp[d]));break;case"special":h.push(e._chkSpecial(b,c,d))}}),a.when.apply(a,h).then(function(){var a=Array.prototype.slice.call(arguments);a.forEach(function(a){a.error&&(i.error=!0,a.format&&(i.format=a.format))}),f.resolve(i)}),f.promise()}),b(d.prototype,"_chkSpecial",function(b,c,d){var e,f=this,g=c.val(),h=a.Deferred();switch(d){case"rune":e={checkType:this.CONST.CHECKTYPE_UNIT,error:this._chkRune(b,c,g),type:"format",format:"rune",target:c},h.resolve(e);break;case"valid-date":this._chkValidDate(b,c,g).done(function(a){e={checkType:f.CONST.CHECKTYPE_UNIT,error:a,type:"format",format:"valid-date",target:c},h.resolve(e)})}return h.promise()}),b(d.prototype,"_chkRune",function(a,b,c){var d,e=0,f=0,g=!1,h=!1;if(c=c.replace("-",""),/[^0-9-\s]+/.test(c))h=!0;else{if(c=c.replace(/\D/g,""),16!==c.length)return"blur"===a.type&&(h=!0),h;for(d=c.length-1;d>=0;d--)f=parseInt(c.charAt(d),10),g&&(f*=2)>9&&(f-=9),e+=f,g=!g;h=e%10!==0}return h}),b(d.prototype,"_chkValidDate",function(b,c,d){var e=a.Deferred(),f=!1;if(/^[0-9]{4}\/[0-9]{2}$/.test(d)||/^[0-9]{4}\/[0-9]{2}\/[0-9]{2}$/.test(d)){var g=d.split("/"),h=parseInt(g[0],10),i=parseInt(g[1],10),j=g[2]?parseInt(g[2],10):1,k=new Date(h,i,1),l=new Date(k.getTime()-864e5),m=l.getDate();(i>12||j>m)&&(f=!0)}return e.resolve(f),e.promise()}),b(d.prototype,"_chkRegexp",function(b,c,d){var e=a.Deferred(),f=c.val(),g={checkType:this.CONST.CHECKTYPE_UNIT,error:!1,type:"regexp",target:c,condition:d};return f&&!f.match(d)&&(g.error=!0),e.resolve(g),e.promise()}),b(d.prototype,"_chkCopy",function(b,c,d){var e=a.Deferred(),f=c.val(),g=a(d),h=g.val(),i=g.data("title")||g.prop("title")||"",j=h.substr(0,f.length),k={checkType:this.CONST.CHECKTYPE_UNIT,error:!1,type:"copy",target:c,condition:g};return f!==j&&(k.error=!0,k.errorMessage=this._getMessage("COPY",i)),e.resolve(k),e.promise()}),b(d.prototype,"_chkSame",function(b,c,d){var e=this,f=a.Deferred(),g=d.body[0],h=d.confirmation[0],i=g.data("title")||g.prop("title")||"",j={checkType:this.CONST.CHECKTYPE_RELATION,error:!1,type:"same",target:c,relations:d},k=g.data("validator-result-"+this.CONST.CHECKTYPE_UNIT)||{};return k.error?(j.noTrigger=!0,f.resolve(j)):"input"===b.type?this._chkCopy(b,c,g.get(0)).done(function(a){j.error=a.error,j.errorMessage=e._getMessage("SAME",i),f.resolve(j)}):"blur"===b.type?(g.val()!==h.val()&&(j.error=!0,j.errorMessage=this._getMessage("SAME",i)),f.resolve(j)):f.resolve(j),f.promise()}),b(d.prototype,"_chkDateAround",function(b,c,d){var e=a.Deferred(),f=d.before[0],g=d.after[0],h=f.data("title")||f.prop("title")||"",i=g.data("title")||g.prop("title")||"",j={checkType:this.CONST.CHECKTYPE_RELATION,error:!1,type:"date-around",target:c,relations:d},k=this._string2Date(f.val()),l=this._string2Date(g.val());return l.getTime()<k.getTime()&&(j.error=!0,j.errorMessage=this._getMessage("DATE-AROUND",h,i)),e.resolve(j),e.promise()}),b(d.prototype,"_string2Date",function(a){var b=a.split("/"),c=parseInt(b[0],10),d=parseInt(b[1]||1,10)-1,e=parseInt(b[2]||1,10);return new Date(c,d,e)}),b(d.prototype,"_chkCredit",function(b,c,d){var e=a.Deferred(),f=d[this.CONST.DEFAULT_ROLE],g=!1,h=[],i={checkType:this.CONST.CHECKTYPE_RELATION,error:!1,type:"credit",target:c,relations:d};return f.forEach(function(a){var b=a.val();b&&4===b.length||(g=!0),h.push(a.val())}),g||(i.error=this._chkRune(b,c,h.join(""))),e.resolve(i),e.promise()})}(),a.fn.validator=function(){var b=Array.prototype.slice.call(arguments);if("string"==typeof b[0]){var e,f,g=a(this),h=g.data("validator");return h&&(e=b.shift(),f=h[e].apply(h,b)),f}return a(this).each(function(){var e,f,g=a(this),h=g.find("input, select, textarea"),i=g.data("validator");return i?void 0:(e=b[0]||{},f=b[1]||[],h.each(function(){var b=a(this),c=b.data("validation");c&&(c.name=b.prop("name"),f.push(c))}),f.forEach(function(a){var b=c(g,a);b.data("validation",a)}),e.$form=g,i=new d(e,f),g.data("validator",i),g)})}}).call(window,jQuery);